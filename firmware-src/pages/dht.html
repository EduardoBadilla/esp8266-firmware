<html>
<head>
    <link rel="stylesheet" type="text/css" href="style.css">

    <title>DHT11/DHT22</title>
    <script type="text/javascript">
        function print(text, err = false) {
            document.getElementById('output').style.color = err ? 'red' : 'green';
            document.getElementById('output').innerHTML = text;
        }
        function run() {
            type = document.getElementById('dht11').checked ? 'dht11' : 'dht22';
            localStorage['accesskey'] = document.getElementById('accesskey').value;
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.open('POST', "http://" + window.location.hostname + '/api/devices/' + type + '/read', true);
            xmlhttp.setRequestHeader("Authorization", "Bearer " + localStorage['accesskey']);
            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState == 4 && isrun) {
                    if (xmlhttp.status < 200 || xmlhttp.status > 299) {
                        print('ERROR: Command returned ' + xmlhttp.status + ' ' + xmlhttp.responseText, true);
                    } else {
                        var json = JSON.parse(xmlhttp.responseText);
                        print('Humidity is ' + json['humidity'] + '%, temperature is ' + json['temperature'] + '&deg;C');
                        setTimeout(function () {
                            run();
                        }, 1000);
                    }
                }
            }
            xmlhttp.send(JSON.stringify({"pin": document.getElementById('pin').value}));
        }
        function init() {
            document.getElementById('accesskey').value = localStorage['accesskey'];
        }
    </script>
</head>
<body onload="init()">
<div class="header">
    <div class="devecihive-logo-text"></div>
    <div class="key-box">
        <label for="accesskey">AccesKey: </label>
        <input class="input-accesskey input-data" type="password" id="accesskey">
    </div>
</div>
</div>
<div class="content">
    <div class="description">This sample humidity and temperature from sensor every 1 second. Click on buttons below to
        start or stop.
    </div>
    <div class="form-block">
        <label class="pin-label" for="pin">Pin:
            <input class="input-data" type='text' id='pin' value='2'>
        </label>
        <div class="description">Choose DHT type:</div>
        <label for="dht11">
            <input type="radio" name="dht" id="dht11" value="dht11" checked="checked">
            <span>DHT11</span>
        </label>
        <label for="dht22">
            <input type="radio" name="dht" id="dht22" value="dht22">
            <span>DHT22</span>
        </label>
        <button type="button" class="btn_event btn_event_green" onclick="isrun=true; print(''); run();">Run</button>
        <button type="button" class="btn_event btn_event_red" onclick="isrun=false; print('Stopped');">Stop</button>
        <div class="output-status" id="output"></div>
    </div>
</div>
</body>
</html>
