<html>
<head>
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>RESTful API</title>
    <script type="text/javascript">
        function printinput(text) {
            document.getElementById('input').innerHTML = text;
        }
        function print(text, err = false) {
            document.getElementById('output').style.color = err ? 'red' : 'green';
            document.getElementById('output').innerHTML = text;
        }
        function run() {
            print('');
            localStorage['accesskey'] = document.getElementById('accesskey').value;
            command = document.getElementById('command').value;
            parameters = document.getElementById('parameters').value;
            if (parameters.length > 0) {
                try {
                    parameters = JSON.parse(parameters);
                } catch (e) {
                    print('Bad JSON', true);
                    return;
                }
            }
            url = "http://" + window.location.hostname + '/api/' + command;
            printinput('This command for cURL util:<br><code>curl -i -X POST  \\<br>     -H "Authorization: Bearer YourAccessKeyHere="  \\<br>'
                + (Object.keys(parameters).length > 0 ? '     -d &#39;' + JSON.stringify(parameters) + '&#39;  \\<br>' : '') + '     ' + url + '</code>');
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.open('POST', url, true);
            xmlhttp.setRequestHeader("Authorization", "Bearer " + localStorage['accesskey']);
            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState == 4) {
                    err = xmlhttp.status < 200 || xmlhttp.status > 299;
                    if (xmlhttp.status == 0) {
                        print('Response is not received', true);
                    } else {
                        print('Response is<br>HTTP/1.0 ' + xmlhttp.status + ' ' + xmlhttp.statusText + '<br>' + xmlhttp.getAllResponseHeaders().split('\r\n').join('<br>') + '<br>' + xmlhttp.responseText, err);
                    }
                }
            }
            xmlhttp.send(Object.keys(parameters).length > 0 ? JSON.stringify(parameters) : null);
        }
        function init() {
            document.getElementById('accesskey').value = localStorage['accesskey'];
        }
    </script>
</head>
<body onload="init()">
<div class="header">
    <div class="devecihive-logo-text"></div>
    <div class="key-box">
        <label for="accesskey">AccesKey: </label>
        <input class="input-accesskey input-data" type="password" id="accesskey">
    </div>
</div>
<div class="content">
    <div class="description">This sample allows to send an arbitrary request and observe a response. Enter command name
        and parameters which
        should be valid JSON and click 'Run' button. Some commands use base64 encoding. There is a simple converter
        <a href='./base64.html' target='_blank'>base64.html</a>.
    </div>
    <div class="form-block">
        <label class="pin-label">Command: <input class="input-data" type="text" id="command" value="gpio/read"></label>
        <label class="pin-label">Parameters:
            <textarea class="margin-reset" id="parameters" rows="10"></textarea>
        </label>
        <button class="btn_event btn_event_green" type="button" value="Run" onclick="run();">Run</button>

        <div class="input_desc extra-margin-top" id="input"></div>

        <div id="output" class="extra-margin-top"></div>
    </div>

</div>

</body>
</html>
